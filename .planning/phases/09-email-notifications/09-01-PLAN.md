---
phase: 09-email-notifications
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/email/descriptor-notifications.ts
autonomous: true

must_haves:
  truths:
    - "Email functions exist for all 5 notification types (submit, approve, approve-modified, return, resubmit)"
    - "Each function accepts typed parameters and returns void (async)"
    - "Each email has both HTML and plain text versions"
  artifacts:
    - path: "src/lib/email/descriptor-notifications.ts"
      provides: "All 5 email notification functions for descriptor workflow"
      exports: ["sendBatchSubmittedNotification", "sendDescriptorApprovedNotification", "sendDescriptorReturnedNotification", "sendDescriptorsResubmittedNotification"]
  key_links:
    - from: "src/lib/email/descriptor-notifications.ts"
      to: "src/lib/email/resend.ts"
      via: "import { sendEmail }"
      pattern: "import.*sendEmail.*from.*resend"
---

<objective>
Create email notification functions for the descriptor approval workflow.

Purpose: Implement NOTIF-01 through NOTIF-05 email content and structure, following existing email template patterns.
Output: `src/lib/email/descriptor-notifications.ts` with 5 exported notification functions.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\LukeBoustridge\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-email-notifications/09-RESEARCH.md

# Existing email patterns to follow
@src/lib/email/resend.ts
@src/lib/email/notifications.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create descriptor-notifications.ts with all 5 email functions</name>
  <files>src/lib/email/descriptor-notifications.ts</files>
  <action>
Create a new file `src/lib/email/descriptor-notifications.ts` with the following 5 notification functions, following the exact patterns from `src/lib/email/notifications.ts`:

**1. sendBatchSubmittedNotification (NOTIF-01)**
- Interface: `{ to: string; scmName: string; descriptorCount: number; }`
- Subject: `Descriptor Review Request: ${count} descriptor(s) pending`
- Body: "${scmName} has submitted ${count} descriptor(s) for your review."
- CTA: "Review Descriptors" -> `${baseUrl}/hub/descriptors/pending-review`

**2. sendDescriptorApprovedNotification (NOTIF-02 and NOTIF-03 combined)**
- Interface: `{ to: string; criterionName: string; saName: string; wasModified: boolean; }`
- Subject: `Descriptor Approved${wasModified ? " with Changes" : ""}: ${criterionName}`
- Body: "Your descriptor '${criterionName}' has been approved by ${saName}."
- If wasModified: Add info box: "Note: The wording was modified during approval. Please review the final version."
- CTA: "View My Descriptors" -> `${baseUrl}/hub/descriptors/my-descriptors`

**3. sendDescriptorReturnedNotification (NOTIF-04)**
- Interface: `{ to: string; criterionName: string; saName: string; comment: string; }`
- Subject: `Descriptor Returned: ${criterionName}`
- Body: "${saName} has returned your descriptor '${criterionName}' with feedback."
- Comment box (yellow background): Display the SA's review comment
- CTA: "Review Feedback" -> `${baseUrl}/hub/descriptors/my-descriptors`

**4. sendDescriptorsResubmittedNotification (NOTIF-05)**
- Interface: `{ to: string; scmName: string; descriptorCount: number; }`
- Subject: `Revised Descriptors Resubmitted: ${count} descriptor(s)`
- Body: "${scmName} has resubmitted ${count} revised descriptor(s) for your review."
- CTA: "Review Descriptors" -> `${baseUrl}/hub/descriptors/pending-review`

**Implementation notes:**
- Import `sendEmail` from `./resend`
- Use `const baseUrl = process.env.NEXT_PUBLIC_APP_URL || "https://skill-tracker.worldskills2026.com"`
- Use `const logoUrl = "https://skill-tracker.worldskills2026.com/logo.png"`
- Copy the exact HTML template structure from notifications.ts (blue header, white card, footer)
- Use singular/plural grammar: `${count === 1 ? "descriptor" : "descriptors"}`
- Always include both `html` and `text` versions in sendEmail call
- For comment/warning boxes, use the existing yellow box pattern from notifications.ts
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors in the new file.
Confirm file exports all 4 functions (sendBatchSubmittedNotification, sendDescriptorApprovedNotification, sendDescriptorReturnedNotification, sendDescriptorsResubmittedNotification).
  </verify>
  <done>
File exists at src/lib/email/descriptor-notifications.ts with all 4 exported functions (note: NOTIF-02 and NOTIF-03 are combined into one function with wasModified parameter), TypeScript compiles without errors.
  </done>
</task>

</tasks>

<verification>
- [ ] `npx tsc --noEmit` passes with no errors
- [ ] File exports 4 functions covering all 5 requirements (NOTIF-02/03 combined)
- [ ] Each function uses sendEmail from resend.ts
- [ ] Each function has both HTML and plain text versions
- [ ] HTML follows existing template structure (blue header, white card, CTA button, footer)
</verification>

<success_criteria>
1. descriptor-notifications.ts exists and exports all notification functions
2. TypeScript compiles without errors
3. Functions follow established patterns from notifications.ts
4. All 5 NOTIF requirements are addressed (NOTIF-02 and NOTIF-03 via wasModified flag)
</success_criteria>

<output>
After completion, create `.planning/phases/09-email-notifications/09-01-SUMMARY.md`
</output>
