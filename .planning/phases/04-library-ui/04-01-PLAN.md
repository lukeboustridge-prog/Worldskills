---
phase: 04-library-ui
plan: 01
type: execute
wave: 1
depends_on: ["03-05"]
files_modified:
  - src/app/descriptors/components/DescriptorList.tsx
  - src/app/descriptors/components/DescriptorModal.tsx
  - src/app/descriptors/components/DescriptorCard.tsx
  - src/components/ui/dialog.tsx
  - src/components/ui/toast.tsx
  - src/components/ui/toaster.tsx
  - src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Users can click a descriptor card to open full preview modal"
    - "Preview modal shows complete criterion with all 4 performance levels"
    - "Toast notification appears when copying to clipboard"
    - "Source attribution badge shows WSC2024 skill origin"
  artifacts:
    - path: "src/app/descriptors/components/DescriptorModal.tsx"
      provides: "Full descriptor preview modal"
      min_lines: 50
    - path: "src/components/ui/dialog.tsx"
      provides: "shadcn/ui Dialog component"
      contains: "DialogContent"
    - path: "src/components/ui/toaster.tsx"
      provides: "Toast notification system"
      contains: "Toaster"
  key_links:
    - from: "DescriptorCard.tsx"
      to: "DescriptorModal.tsx"
      via: "onClick opens modal with descriptor data"
      pattern: "onClick.*setSelected"
    - from: "copy action"
      to: "toast notification"
      via: "toast() call after clipboard write"
      pattern: "toast\\("
---

<objective>
Add preview modal for full descriptor view and toast notifications for copy feedback

Purpose: Enable users to see complete descriptor details (UI-03), get visual copy confirmation (UI-04 enhancement), and see clear source attribution (UI-05)
Output: Dialog modal component, toast system integration, enhanced descriptor cards
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/app/descriptors/page.tsx
@src/app/descriptors/components/DescriptorList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn/ui Dialog and Toast components</name>
  <files>src/components/ui/dialog.tsx, src/components/ui/toast.tsx, src/components/ui/toaster.tsx, src/components/ui/use-toast.ts</files>
  <action>
Install the required shadcn/ui components:

```bash
npx shadcn@latest add dialog toast
```

This will create:
- src/components/ui/dialog.tsx - Modal dialog component
- src/components/ui/toast.tsx - Toast notification component
- src/components/ui/toaster.tsx - Toast container
- src/hooks/use-toast.ts (or similar) - Toast hook

After installation, add the Toaster to the root layout:

Update `src/app/layout.tsx` to include the Toaster component inside the providers but at the end of the body content.
  </action>
  <verify>
Dialog and Toast components exist in src/components/ui/.
Toaster is added to layout.tsx.
  </verify>
  <done>shadcn/ui Dialog and Toast installed, Toaster added to layout</done>
</task>

<task type="auto">
  <name>Task 2: Create DescriptorModal component</name>
  <files>src/app/descriptors/components/DescriptorModal.tsx</files>
  <action>
Create a modal component that shows the full descriptor details:

```typescript
"use client";

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Copy, Check, ExternalLink } from "lucide-react";
import { useState } from "react";
import { useToast } from "@/hooks/use-toast";
import type { SearchResult } from "@/lib/search-descriptors";

interface DescriptorModalProps {
  descriptor: SearchResult | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

export function DescriptorModal({ descriptor, open, onOpenChange }: DescriptorModalProps) {
  const { toast } = useToast();
  const [copiedField, setCopiedField] = useState<string | null>(null);

  if (!descriptor) return null;

  const copyToClipboard = async (text: string, field: string, label: string) => {
    try {
      await navigator.clipboard.writeText(text);
      setCopiedField(field);
      toast({
        title: "Copied to clipboard",
        description: `${label} copied successfully`,
      });
      setTimeout(() => setCopiedField(null), 2000);
    } catch (err) {
      toast({
        title: "Copy failed",
        description: "Could not copy to clipboard",
        variant: "destructive",
      });
    }
  };

  const copyAllLevels = async () => {
    const levels = [
      descriptor.excellent && `Excellent: ${descriptor.excellent}`,
      descriptor.good && `Good: ${descriptor.good}`,
      descriptor.pass && `Pass: ${descriptor.pass}`,
      descriptor.belowPass && `Below Pass: ${descriptor.belowPass}`,
    ].filter(Boolean).join("\n\n");

    const fullText = `${descriptor.criterionName}\n\n${levels}`;
    await copyToClipboard(fullText, "all", "Complete criterion");
  };

  const CopyButton = ({ text, field, label }: { text: string; field: string; label: string }) => (
    <Button
      variant="ghost"
      size="sm"
      className="h-8 px-2"
      onClick={() => copyToClipboard(text, field, label)}
    >
      {copiedField === field ? (
        <Check className="h-4 w-4 text-green-500" />
      ) : (
        <Copy className="h-4 w-4" />
      )}
      <span className="ml-1 text-xs">Copy</span>
    </Button>
  );

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <div className="flex items-start justify-between gap-4">
            <div>
              <DialogTitle className="text-xl">{descriptor.criterionName}</DialogTitle>
              <div className="flex items-center gap-2 mt-2">
                <Badge variant="outline" className="bg-blue-50 text-blue-700 border-blue-200">
                  WSC2024: {descriptor.skillName}
                </Badge>
                {descriptor.category && (
                  <Badge variant="outline">{descriptor.category}</Badge>
                )}
                <Badge
                  variant={descriptor.qualityIndicator === "EXCELLENT" ? "default" : "outline"}
                >
                  {descriptor.qualityIndicator}
                </Badge>
              </div>
            </div>
          </div>
        </DialogHeader>

        <div className="space-y-4 mt-4">
          <div className="flex justify-end">
            <Button variant="outline" size="sm" onClick={copyAllLevels}>
              <Copy className="h-4 w-4 mr-2" />
              Copy All Levels
            </Button>
          </div>

          {descriptor.excellent && (
            <div className="border rounded-lg p-4 bg-green-50/50">
              <div className="flex items-center justify-between mb-2">
                <span className="font-semibold text-green-700">Excellent</span>
                <CopyButton text={descriptor.excellent} field="excellent" label="Excellent level" />
              </div>
              <p className="text-sm whitespace-pre-wrap">{descriptor.excellent}</p>
            </div>
          )}

          {descriptor.good && (
            <div className="border rounded-lg p-4 bg-blue-50/50">
              <div className="flex items-center justify-between mb-2">
                <span className="font-semibold text-blue-700">Good</span>
                <CopyButton text={descriptor.good} field="good" label="Good level" />
              </div>
              <p className="text-sm whitespace-pre-wrap">{descriptor.good}</p>
            </div>
          )}

          {descriptor.pass && (
            <div className="border rounded-lg p-4 bg-yellow-50/50">
              <div className="flex items-center justify-between mb-2">
                <span className="font-semibold text-yellow-700">Pass</span>
                <CopyButton text={descriptor.pass} field="pass" label="Pass level" />
              </div>
              <p className="text-sm whitespace-pre-wrap">{descriptor.pass}</p>
            </div>
          )}

          {descriptor.belowPass && (
            <div className="border rounded-lg p-4 bg-red-50/50">
              <div className="flex items-center justify-between mb-2">
                <span className="font-semibold text-red-700">Below Pass</span>
                <CopyButton text={descriptor.belowPass} field="belowPass" label="Below Pass level" />
              </div>
              <p className="text-sm whitespace-pre-wrap">{descriptor.belowPass}</p>
            </div>
          )}

          {descriptor.tags && descriptor.tags.length > 0 && (
            <div className="pt-4 border-t">
              <span className="text-sm font-medium text-muted-foreground">Tags: </span>
              {descriptor.tags.map((tag) => (
                <Badge key={tag} variant="outline" className="mr-1">
                  {tag}
                </Badge>
              ))}
            </div>
          )}

          <div className="text-xs text-muted-foreground pt-2 border-t">
            Code: {descriptor.code} | Sector: {descriptor.sector || "N/A"}
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

Key features:
- Full display of all 4 performance levels with color coding
- Copy individual levels or all at once
- Toast notifications for copy feedback
- WSC2024 source attribution badge (blue styling for trust)
- Tags display
- Scrollable content for long descriptors
  </action>
  <verify>
Component compiles without TypeScript errors.
  </verify>
  <done>DescriptorModal component created with full preview and toast integration</done>
</task>

<task type="auto">
  <name>Task 3: Refactor DescriptorList to use modal</name>
  <files>src/app/descriptors/components/DescriptorList.tsx</files>
  <action>
Update DescriptorList to:
1. Track selected descriptor state
2. Open modal on card click
3. Use toast for copy feedback in cards too

The card should be clickable to open the modal, with copy buttons still working (stopPropagation).

Update the component to add:
- useState for selectedDescriptor
- DescriptorModal import and render
- onClick handler on Card to open modal
- stopPropagation on copy buttons
- useToast for copy feedback
  </action>
  <verify>
Click card opens modal.
Copy buttons work without opening modal.
Toast appears on copy.
  </verify>
  <done>DescriptorList refactored with modal integration and toast notifications</done>
</task>

<task type="auto">
  <name>Task 4: Verify complete flow</name>
  <files>None (verification only)</files>
  <action>
Test the complete flow:

1. **Card display:**
   - Cards show truncated performance levels
   - Source skill name visible
   - Copy buttons visible on hover

2. **Modal:**
   - Click card opens modal
   - Modal shows all 4 performance levels in full
   - WSC2024 badge clearly visible
   - Each level has copy button
   - "Copy All Levels" button works

3. **Toast notifications:**
   - Toast appears on copy
   - Toast shows what was copied
   - Toast auto-dismisses

4. **TypeScript:**
   - Run `npx tsc --noEmit` - no errors in descriptor components

5. **Responsive:**
   - Modal works on smaller screens (max-h-[90vh] with scroll)
  </action>
  <verify>
All flows work as described.
TypeScript compiles.
  </verify>
  <done>Complete modal and toast flow verified</done>
</task>

</tasks>

<verification>
1. Click descriptor card - modal opens with full details
2. Modal shows WSC2024 source badge prominently
3. All 4 performance levels displayed with color coding
4. Copy individual level - toast shows "Copied to clipboard"
5. Copy all levels - combines all levels into clipboard
6. Click outside modal - closes
7. TypeScript compiles without errors
</verification>

<success_criteria>
- Preview modal shows complete descriptor (UI-03)
- Toast notifications for copy feedback (UI-04 enhancement)
- WSC2024 source attribution badge (UI-05)
- Performance levels color-coded and grouped (UI-06 enhancement)
- Clear visual hierarchy in modal (UI-07)
</success_criteria>

<output>
After completion, create `.planning/phases/04-library-ui/04-01-SUMMARY.md`
</output>
