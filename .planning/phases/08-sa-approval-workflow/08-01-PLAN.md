---
phase: 08-sa-approval-workflow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
autonomous: true

must_haves:
  truths:
    - "Descriptor model has wasModifiedDuringApproval Boolean field"
    - "Existing 228 descriptors unaffected (field defaults to false)"
    - "Database migration runs without errors"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "wasModifiedDuringApproval field on Descriptor"
      contains: "wasModifiedDuringApproval Boolean"
    - path: "prisma/migrations/*_add_was_modified_during_approval/migration.sql"
      provides: "Database migration for new field"
      contains: "wasModifiedDuringApproval"
  key_links:
    - from: "prisma/schema.prisma"
      to: "database"
      via: "prisma db push or migrate"
      pattern: "wasModifiedDuringApproval.*Boolean"
---

<objective>
Add wasModifiedDuringApproval field to Descriptor model for tracking SA modifications during approval.

Purpose: APPR-04 requires tracking whether SA changed descriptor wording before approving. This field enables the modification flag without version history complexity.
Output: Updated schema with new Boolean field and successful migration.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\LukeBoustridge\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-sa-approval-workflow/08-RESEARCH.md

# Current schema
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add wasModifiedDuringApproval field to Descriptor model</name>
  <files>prisma/schema.prisma</files>
  <action>
Add wasModifiedDuringApproval Boolean field to the Descriptor model after the reviewComment field.

Location: Find the reviewComment field (around line 451) and add after it:

```prisma
// Modification tracking for SA approval workflow (APPR-04)
wasModifiedDuringApproval Boolean @default(false)
```

The field:
- Defaults to false (existing descriptors unaffected)
- Set to true when SA changes wording before approving
- Allows email notification in Phase 9 to indicate if wording was modified
  </action>
  <verify>
Run `npx prisma validate` - should pass with no errors.
  </verify>
  <done>Descriptor model includes wasModifiedDuringApproval Boolean @default(false) field.</done>
</task>

<task type="auto">
  <name>Task 2: Run database migration</name>
  <files>prisma/migrations/*</files>
  <action>
Run Prisma migration to add the new column to the production database.

```bash
npx prisma migrate dev --name add_was_modified_during_approval
```

This will:
1. Create migration file with ALTER TABLE
2. Apply migration to database
3. Regenerate Prisma client with new field

If using `prisma db push` instead (for faster dev iteration):
```bash
npx prisma db push
```

Verify existing descriptors are unaffected by checking a few records.
  </action>
  <verify>
1. `npx prisma migrate status` shows migration applied
2. Query: `SELECT "wasModifiedDuringApproval" FROM "Descriptor" LIMIT 5` returns false for all existing records
3. `npx prisma generate` completes successfully
  </verify>
  <done>Database has wasModifiedDuringApproval column, existing records default to false, Prisma client regenerated.</done>
</task>

</tasks>

<verification>
1. Schema validation passes: `npx prisma validate`
2. Migration applied successfully
3. TypeScript types updated (Descriptor includes wasModifiedDuringApproval)
4. Existing descriptor data preserved
</verification>

<success_criteria>
- [ ] wasModifiedDuringApproval Boolean field exists on Descriptor model
- [ ] Field has @default(false) annotation
- [ ] Database migration runs without errors
- [ ] Existing 228 descriptors have wasModifiedDuringApproval = false
- [ ] Prisma client regenerated with new field in types
</success_criteria>

<output>
After completion, create `.planning/phases/08-sa-approval-workflow/08-01-SUMMARY.md`
</output>
